# MINIMAL TEST CONFIG FOR LOFTWAY
esphome:
  name: loftway
  friendly_name: LoftWay
  on_boot:
    priority: -100
    then:
      - light.turn_on:
          id: display_backlight
          brightness: 100%
      - lambda: |-
          ESP_LOGI("boot", "=== MINIMAL TEST Boot Complete ===");

esp32:
  board: esp32-c3-devkitm-1
  framework:
    type: esp-idf

logger:
  level: INFO

api:
  encryption:
    key: "bbPqKzlRqaDwTVSkjY4EQ7Qk2b4abgkozeDiwwEWI5w="

ota:
  - platform: esphome
    password: "629ce264867a48aca47fe3655f629c81"

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  power_save_mode: NONE
  fast_connect: false
  reboot_timeout: 15min

# SPI for TFT Display
spi:
  clk_pin: GPIO2
  mosi_pin: GPIO7

# Colors
color:
  - id: color_white
    white: 100%
  - id: color_black
    red: 0%
    green: 0%
    blue: 0%
  - id: color_blue
    red: 0%
    green: 50%
    blue: 100%
  - id: color_red
    red: 100%
    green: 0%
    blue: 0%

# Backlight
output:
  - platform: ledc
    pin: GPIO8
    id: backlight_pwm
    frequency: 1000Hz

light:
  - platform: monochromatic
    output: backlight_pwm
    id: display_backlight
    name: "Display Backlight"
    default_transition_length: 0.3s
    restore_mode: RESTORE_DEFAULT_OFF

# Font
font:
  - file: "gfonts://Roboto"
    id: font_test
    size: 20

# TFT Display
display:
  - platform: st7789v
    model: Custom
    height: 240
    width: 240
    offset_height: 0
    offset_width: 0
    cs_pin: GPIO10
    dc_pin: GPIO6
    reset_pin: GPIO5
    rotation: 0
    update_interval: 1s
    lambda: |-
      it.fill(id(color_white));
      it.print(10, 10, id(font_test), id(color_black), "LoftWay TEST");
      it.print(10, 40, id(font_test), id(color_blue), "Display OK");
      it.rectangle(0, 0, 240, 240, id(color_red));

# MQ2 Gas Sensor
sensor:
  - platform: adc
    name: "MQ2 Gas/Smoke Level - Raw"
    pin: GPIO3
    id: mq2_analog_raw
    unit_of_measurement: "V"
    accuracy_decimals: 3
    update_interval: 5s
    attenuation: 11db
    internal: true

