# APC AP7920 PDU Configuration for Home Assistant - WITH POWER MONITORING
# Device IP: 192.168.1.28
# SNMP Version: v1
# Community: 5stream
# Device Label: cAPC3

# This configuration includes rPDU2 MIB OIDs discovered via SNMP walk
# Base OID: .1.3.6.1.4.1.318.1.1.12 (rPDU2)

sensor:
  # ============================================================================
  # PDU IDENTIFICATION
  # ============================================================================
  
  - platform: snmp
    name: "cAPC3 Name"
    unique_id: apc_pdu_capc3_name_rpdu
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.1.1.0
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Hardware Revision"
    unique_id: apc_pdu_capc3_hardware_revision_rpdu
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.1.2.0
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Firmware Revision"
    unique_id: apc_pdu_capc3_firmware_revision_rpdu
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.1.3.0
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Model Number"
    unique_id: apc_pdu_capc3_model_number_rpdu
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.1.5.0
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Serial Number"
    unique_id: apc_pdu_capc3_serial_number_rpdu
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.1.6.0
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Outlet Count"
    unique_id: apc_pdu_capc3_outlet_count_rpdu
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.1.8.0
    version: "1"

  # ============================================================================
  # PDU OVERALL POWER INFORMATION
  # ============================================================================
  
  - platform: snmp
    name: "cAPC3 Rated Voltage"
    unique_id: apc_pdu_capc3_rated_voltage
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.1.15.0
    version: "1"
    unit_of_measurement: "V"
    device_class: voltage
    
  - platform: snmp
    name: "cAPC3 Rated Max Current"
    unique_id: apc_pdu_capc3_rated_max_current
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.1.17.0
    version: "1"
    # Value is in tenths of amps (1000 = 10.0A)
    value_template: "{{ (value | int / 100) | round(1) }}"
    unit_of_measurement: "A"
    device_class: current

  # Bank/Phase Power Information
  - platform: snmp
    name: "cAPC3 Phase Count"
    unique_id: apc_pdu_capc3_phase_count
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.2.1.1.0
    version: "1"

  # Bank 1 Power Status
  - platform: snmp
    name: "cAPC3 Bank 1 Load State"
    unique_id: apc_pdu_capc3_bank_1_load_state
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.2.3.1.1.3.1
    version: "1"
    value_template: >
      {% if value == '1' %}Low Load
      {% elif value == '2' %}Normal
      {% elif value == '3' %}Near Overload
      {% elif value == '4' %}Overload
      {% else %}Unknown{% endif %}

  # ============================================================================
  # OUTLET STATUS AND NAMES
  # ============================================================================
  
  # Outlet 1
  - platform: snmp
    name: "cAPC3 Outlet 1 Name"
    unique_id: apc_pdu_capc3_outlet_1_name_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.2.1
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Outlet 1 Status"
    unique_id: apc_pdu_capc3_outlet_1_status_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.4.1
    version: "1"
    value_template: >
      {% if value == '1' %}On
      {% elif value == '2' %}Off
      {% else %}Unknown{% endif %}

  - platform: snmp
    name: "cAPC3 Outlet 1 Power"
    unique_id: apc_pdu_capc3_outlet_1_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.7.1
    version: "1"
    unit_of_measurement: "W"
    device_class: power

  # Outlet 2
  - platform: snmp
    name: "cAPC3 Outlet 2 Name"
    unique_id: apc_pdu_capc3_outlet_2_name_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.2.2
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Outlet 2 Status"
    unique_id: apc_pdu_capc3_outlet_2_status_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.4.2
    version: "1"
    value_template: >
      {% if value == '1' %}On
      {% elif value == '2' %}Off
      {% else %}Unknown{% endif %}

  - platform: snmp
    name: "cAPC3 Outlet 2 Power"
    unique_id: apc_pdu_capc3_outlet_2_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.7.2
    version: "1"
    unit_of_measurement: "W"
    device_class: power

  # Outlet 3
  - platform: snmp
    name: "cAPC3 Outlet 3 Name"
    unique_id: apc_pdu_capc3_outlet_3_name_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.2.3
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Outlet 3 Status"
    unique_id: apc_pdu_capc3_outlet_3_status_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.4.3
    version: "1"
    value_template: >
      {% if value == '1' %}On
      {% elif value == '2' %}Off
      {% else %}Unknown{% endif %}

  - platform: snmp
    name: "cAPC3 Outlet 3 Power"
    unique_id: apc_pdu_capc3_outlet_3_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.7.3
    version: "1"
    unit_of_measurement: "W"
    device_class: power

  # Outlet 4
  - platform: snmp
    name: "cAPC3 Outlet 4 Name"
    unique_id: apc_pdu_capc3_outlet_4_name_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.2.4
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Outlet 4 Status"
    unique_id: apc_pdu_capc3_outlet_4_status_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.4.4
    version: "1"
    value_template: >
      {% if value == '1' %}On
      {% elif value == '2' %}Off
      {% else %}Unknown{% endif %}

  - platform: snmp
    name: "cAPC3 Outlet 4 Power"
    unique_id: apc_pdu_capc3_outlet_4_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.7.4
    version: "1"
    unit_of_measurement: "W"
    device_class: power

  # Outlet 5
  - platform: snmp
    name: "cAPC3 Outlet 5 Name"
    unique_id: apc_pdu_capc3_outlet_5_name_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.2.5
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Outlet 5 Status"
    unique_id: apc_pdu_capc3_outlet_5_status_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.4.5
    version: "1"
    value_template: >
      {% if value == '1' %}On
      {% elif value == '2' %}Off
      {% else %}Unknown{% endif %}

  - platform: snmp
    name: "cAPC3 Outlet 5 Power"
    unique_id: apc_pdu_capc3_outlet_5_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.7.5
    version: "1"
    unit_of_measurement: "W"
    device_class: power

  # Outlet 6
  - platform: snmp
    name: "cAPC3 Outlet 6 Name"
    unique_id: apc_pdu_capc3_outlet_6_name_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.2.6
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Outlet 6 Status"
    unique_id: apc_pdu_capc3_outlet_6_status_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.4.6
    version: "1"
    value_template: >
      {% if value == '1' %}On
      {% elif value == '2' %}Off
      {% else %}Unknown{% endif %}

  - platform: snmp
    name: "cAPC3 Outlet 6 Power"
    unique_id: apc_pdu_capc3_outlet_6_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.7.6
    version: "1"
    unit_of_measurement: "W"
    device_class: power

  # Outlet 7
  - platform: snmp
    name: "cAPC3 Outlet 7 Name"
    unique_id: apc_pdu_capc3_outlet_7_name_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.2.7
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Outlet 7 Status"
    unique_id: apc_pdu_capc3_outlet_7_status_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.4.7
    version: "1"
    value_template: >
      {% if value == '1' %}On
      {% elif value == '2' %}Off
      {% else %}Unknown{% endif %}

  - platform: snmp
    name: "cAPC3 Outlet 7 Power"
    unique_id: apc_pdu_capc3_outlet_7_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.7.7
    version: "1"
    unit_of_measurement: "W"
    device_class: power

  # Outlet 8
  - platform: snmp
    name: "cAPC3 Outlet 8 Name"
    unique_id: apc_pdu_capc3_outlet_8_name_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.2.8
    version: "1"
    
  - platform: snmp
    name: "cAPC3 Outlet 8 Status"
    unique_id: apc_pdu_capc3_outlet_8_status_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.4.8
    version: "1"
    value_template: >
      {% if value == '1' %}On
      {% elif value == '2' %}Off
      {% else %}Unknown{% endif %}

  - platform: snmp
    name: "cAPC3 Outlet 8 Power"
    unique_id: apc_pdu_capc3_outlet_8_power
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.5.1.1.7.8
    version: "1"
    unit_of_measurement: "W"
    device_class: power

# ============================================================================
# OUTLET CONTROL SWITCHES
# ============================================================================

switch:
  # Outlet 1 Control
  - platform: snmp
    name: "cAPC3 Outlet 1"
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.1
    version: "1"
    payload_on: 1
    payload_off: 2
    
  # Outlet 2 Control
  - platform: snmp
    name: "cAPC3 Outlet 2"
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.2
    version: "1"
    payload_on: 1
    payload_off: 2
    
  # Outlet 3 Control
  - platform: snmp
    name: "cAPC3 Outlet 3"
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.3
    version: "1"
    payload_on: 1
    payload_off: 2
    
  # Outlet 4 Control
  - platform: snmp
    name: "cAPC3 Outlet 4"
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.4
    version: "1"
    payload_on: 1
    payload_off: 2
    
  # Outlet 5 Control
  - platform: snmp
    name: "cAPC3 Outlet 5"
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.5
    version: "1"
    payload_on: 1
    payload_off: 2
    
  # Outlet 6 Control
  - platform: snmp
    name: "cAPC3 Outlet 6"
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.6
    version: "1"
    payload_on: 1
    payload_off: 2
    
  # Outlet 7 Control
  - platform: snmp
    name: "cAPC3 Outlet 7"
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.7
    version: "1"
    payload_on: 1
    payload_off: 2
    
  # Outlet 8 Control
  - platform: snmp
    name: "cAPC3 Outlet 8"
    host: 192.168.1.28
    community: 5stream
    baseoid: .1.3.6.1.4.1.318.1.1.12.3.3.1.1.4.8
    version: "1"
    payload_on: 1
    payload_off: 2

# ============================================================================
# NOTES:
# ============================================================================
# 1. Power values (OID .7.X) in SNMP walk showed as Gauge32: 0 - this might mean:
#    - The outlets are off (no load)
#    - Power monitoring is not enabled on this model
#    - Values need different interpretation
#
# 2. To verify power monitoring works, test with:
#    snmpget -v1 -c 5stream 192.168.1.28 .1.3.6.1.4.1.318.1.1.12.3.5.1.1.7.1
#    (with outlet 1 turned on and under load)
#
# 3. Alternative power OIDs to try if above doesn't work:
#    - .1.3.6.1.4.1.318.1.1.12.2.3.1.1.2.1 (bank/phase power)
#    - Base64 encoded values at .1.3.6.1.4.1.318.1.4.2.6.1.4.X
